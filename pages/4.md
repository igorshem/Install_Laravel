* [Оглавление](../README.md)
* [Предыдующая](3.md)
* [Следующая](5.md)

# 4. Laravel
* Composer заточен на работу в среде PHP 7.2. 
* Laravel 10 заточен на работу в среде PHP 8.1
* При этом OS-консоль поддерживает ту версию PHP, при которой был запущен. Перезапуск OS не меняет поддерживаемую версию PHP уже запущенной консоли.
* Имеющиеся пункты "Проверка работы: открыть в браузере" просят перехода на версию PHP, на которой написан Laravel (8.1). В то время как для корректной работы Composer-а требуется переходить на 7.2
* Все команды даны для консоли OS Panel:
> Иконка возле часов -> ПКМ -> Дополнительно -> Консоль

### 4.1. Проверка версий
#### Laravel
> php artisan -v

### 4.2. Создаём папку (XXX) проекта в папке:
> d:\OS541\domains\XXX

Имеется несколько правил именования:
- пробелы запрещены
- для локальных серверов лучше использовать домены: **".loc", ".local", ".my"**
- папка должна быть пуста

### 4.3 Настройка OpenServer
> Иконка OS возле часов -> ПКИ -> Настройки -> Модули

Установить в combobox-ах значения версии PHP, не противоречащие Composer (не менее 7.2). В идеале брать 7.2, но 8.1 подошла для установки Laravel 10, в то время как вылетала ошибка для Laravel 8.
> HTTP
> PHP
### 4.4 Установка Laravel (XXX - название папки проекта, см.4.2)
> composer create-project laravel/laravel --prefer-dist XXX
### 4.5 Запуск OpenServer
### 4.6 Проверка работоспособности Laravel
#### 4.6.1 Проверка работы: открыть в браузере
> http://XXX

- Если ошибка 404 - см. п.4.6.2
- Если каталог файлов - см. п.4.6.7
#### 4.6.2 Переброска портов
> Иконка OS возле часов -> ПКИ -> Настройки -> Сервер

* Исправить порт HTTP, например на 81
* Настройка использования переменной Path:
> Свой Path + Win Path
* Сохранить, перезапустить OpenServer
#### 4.6.3 Проверка работы: открыть в браузере
> http://XXX:81

- Если каталог файлов - см. п.4.6.7
- Если браузер не видит наш хост, но при этом видит localhost - перепроверить выполнение п.4.6.2 и далее - п.4.6.4
#### 4.6.4 Проверить доступность файла <hosts.> (без расширения).
Располагается в системной папке (папка etc невидима, но если вбить вручную - откроется):
> C:\Windows\System32\drivers\etc\

Файл должен быть:
* открыт на редактирование
* в нём должна быть инструкция подключения нашего хоста (связывает имя <localhost> с ip <127.0.0.1>). Например,
> <127.0.0.1 localhost>

Вручную обновляем win-конфигурацию сети (если пришлось вручную править <hosts.>). Открыть cmd.exe и выполнить (очистка кэша):
> ipconfig /flushdns
#### 4.6.5 Проверка работы: открыть в браузере
> http://XXX:81
- Если каталог файлов - см. п.4.6.7
- Если браузер не видит наш хост, но при этом видит localhost - перепроверить выполнение п.4.6.2, п.4.6.4 и далее - п.4.6.6
#### 4.6.6 Возможно проблема в дурацких корпоративных политиках (брандмаузер)
> Панель управления -> Свойства браузера. Вкладка "Подключения" -> Настройка сети -> Дополнительно

Добавить своё имя сайта в "Исключения" по аналогии (где символ ";" - разделитель имён сайтов): 
> ;*laravel3.loc*>

Повторить проверку (см. п.4.6.5)
#### 4.6.7 Привязываем папку входа сайта.
Можно реализовать 2-мя различными способами:
п.4.6.7.1 - используя mod_rewrite (Apache)
п.4.6.7.2 - используя средства OpenServer
Локально будут работать обе версии, но с точки зрения решения проблемы один раз выгоднее решить с помощью первого метода, т.к. во время выкладывания файлов на сервер вопрос снова встанет для второго метода и всё равно приёдется городить mod_rewrite
##### 4.6.7.1 Mod_rewrite. 
В корне созданного проекта (XXX) создаём файл 
> .htaccess

(файл без имени, но с расширением) с текстом:
```
<IfModule mod_rewrite.c>
Options +FollowSymLinks
RewriteEngine On

RewriteCond %{REQUEST_URI} !^/public/

RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f

RewriteRule ^(.*)$ /public/$1
#RewriteRule ^ index.php [L]
RewriteRule ^(/)?$ public/index.php [L]
</IfModule>
```
##### 4.6.7.2 OpenServer
> Иконка OS возле часов -> ПКИ -> Настройки -> Домены

Управление доменами = **Ручное+Автопоиск**
Имя домена = **ХХХ**
Папка домена = **ХХХ/public**
#### 4.6.8 Проверка работы: открыть в браузере
> http://XXX:81
- Если приглашалка Laravel - см. п.4.7
- Если ошибка "Не найден файл autoload.php": "Fatal error: Uncaught Error: Failed opening required 'D:\OS541\domains\XXX\public/../vendor/autoload.php' (include_path='.') in ...\XXX\public\index.php"

При ручном просмотре результатов установки в папке проекта (XXX) отсутствует папка **vendor**. Возможно несколько проблем - см. 4.6.8.Х
##### 4.6.8.1 Настройка php.ini
> Иконка OS возле часов -> ПКИ -> Дополнительно -> Конфигурация PHP

Раскомментировать в php.ini **"extension = fileinfo"** (убрать вначале строки символ <;> точка с запятой).
##### 4.6.8.2 Старая версия composer
Для обновления см. п.1.2.2
##### 4.6.8.3 Пересоздаём проект Laravel (см. п.4.4)